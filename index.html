<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>匿名留言板</title>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js"></script>
</head>

<body>
    <h2>匿名留言板</h2>
    <textarea id="message" placeholder="輸入你的留言..."></textarea>
    <button onclick="sendMessage()">提交</button>
    <ul id="messagesList"></ul>

    <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration

        const firebaseConfig = {
            apiKey: process.env.REACT_APP_FIREBASE_API_KEY,
            authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,
            projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,
            storageBucket: process.env.REACT_APP_STORAGE_BUCKET,
            messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.REACT_APP_FIREBASE_APP_ID

            };

        const app = initializeApp(firebaseConfig);

        //const db = firebase.firestore();

        // 🔹 發送留言
        function sendMessage() {
            const message = document.getElementById("message").value;
            db.collection("messages").add({
                content: message,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById("message").value = "";
            });
        }

        // 🔹 讀取並顯示留言（即時更新）
        db.collection("messages").orderBy("timestamp", "desc").onSnapshot(snapshot => {
            const list = document.getElementById("messagesList");
            list.innerHTML = "";
            snapshot.forEach(doc => {
                let li = document.createElement("li");
                li.textContent = doc.data().content;
                list.appendChild(li);
            });
        });
    </script>
</body>

</html>