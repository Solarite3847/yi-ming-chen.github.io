<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>匿名留言板</title>
</head>

<body>
    <h2>匿名留言板</h2>
    
    <input type="text" id="nameInput" placeholder="你的名稱 (可留空)">
    <br>
    <textarea id="message" placeholder="輸入你的留言..."></textarea>
    <br>
    <button id="submitBtn">提交</button>

    <ul id="messagesList"></ul>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        // 🔥 初始化 Firebase
        const firebaseConfig = {
            apiKey: process.env.REACT_APP_FIREBASE_API_KEY,
            authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,
            projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,
            storageBucket: process.env.REACT_APP_STORAGE_BUCKET,
            messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,
            appId: process.env.REACT_APP_FIREBASE_APP_ID

            };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 🚀 發送留言函式
       function sendMessage() {
    const message = document.getElementById("message").value || "匿名留言"; // 預設匿名

    db.collection("messages").add({
        content: message,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    }).then(() => {
        console.log("✅ 留言成功寫入 Firestore!");
        document.getElementById("message").value = ""; // 清空輸入框
    }).catch((error) => {
        console.error("❌ 錯誤:", error);
    });
}


            db.collection("messages").add({
                name: name || "匿名",  // 如果沒有輸入名稱，就預設為「匿名」
                content: message,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById("message").value = "";
            }).catch((error) => {
                console.error("Error adding message: ", error);
            });
        }

        // 🔹 綁定按鈕點擊事件
        document.getElementById("submitBtn").addEventListener("click", sendMessage);

        // 🔹 讀取並顯示留言（即時更新）
        db.collection("messages").orderBy("timestamp", "desc").onSnapshot(snapshot => {
            const list = document.getElementById("messagesList");
            list.innerHTML = "";
            snapshot.forEach(doc => {
                let li = document.createElement("li");
                let data = doc.data();
                li.textContent = `${data.name}: ${data.content}`;
                list.appendChild(li);
            });
        });
    </script>
</body>

</html>
